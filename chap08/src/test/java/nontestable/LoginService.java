package nontestable;

import auth.AuthUtil;
import auth.Customer;
import auth.CustomerRepository;
import auth.LoginResult;

public class LoginService {

	private String authKey = "somekey";
	private CustomerRepository customerRepo;

	public LoginService(CustomerRepository customerRepo) {
		this.customerRepo = customerRepo;
	}

	public LoginResult login(String id, String pw) {
		int resp = 0;
		boolean authorized = AuthUtil.authorize(authKey);

		if (authorized) {
			resp = AuthUtil.authenticate(id, pw);
		} else {
			resp = -1;
		}

		if (resp == -1) {
			return LoginResult.badAuthKey();
		}

		if (resp == 1) {
			Customer c = customerRepo.findOne(id);
			return LoginResult.badAuthKey();
		} else {
			return LoginResult.fail(resp);
		}
	}
}
